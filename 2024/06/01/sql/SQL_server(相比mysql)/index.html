<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"maofe3o4.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":true},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="对照之前的mysql做的笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="SQL SERVER数据库">
<meta property="og:url" content="https://maofe3o4.github.io/2024/06/01/sql/SQL_server(%E7%9B%B8%E6%AF%94mysql)/">
<meta property="og:site_name" content="我真不是雪上加霜">
<meta property="og:description" content="对照之前的mysql做的笔记">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-06-01T04:00:00.000Z">
<meta property="article:modified_time" content="2024-08-10T05:51:04.054Z">
<meta property="article:author" content="我真不是雪上加霜">
<meta property="article:tag" content="sql server">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://maofe3o4.github.io/2024/06/01/sql/SQL_server(%E7%9B%B8%E6%AF%94mysql)/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SQL SERVER数据库 | 我真不是雪上加霜</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">我真不是雪上加霜</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://maofe3o4.github.io/2024/06/01/sql/SQL_server(%E7%9B%B8%E6%AF%94mysql)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/%E5%85%AD%E8%8A%B1.gif">
      <meta itemprop="name" content="我真不是雪上加霜">
      <meta itemprop="description" content="失败总是贯穿人生始终">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我真不是雪上加霜">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SQL SERVER数据库
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-06-01 12:00:00" itemprop="dateCreated datePublished" datetime="2024-06-01T12:00:00+08:00">2024-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-08-10 13:51:04" itemprop="dateModified" datetime="2024-08-10T13:51:04+08:00">2024-08-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>
            <div class="post-description">对照之前的mysql做的笔记</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p><span id="jump1">目录</span></p>
<p>[toc]</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/sql/t-sql/language-reference?view=sql-server-2016">官方参考文档</a></p>
<p>MySQL：3306<br>SQL Server：1433<br>Oracle：1521<br>Redis：6379<br>PostgreSQL：5432<br>MongoDB：27017<br>SQL server 2008版本是10.25 、SQL server 2008R2版本是10.50</p>
<h2 id="系统数据库"><a href="#系统数据库" class="headerlink" title="系统数据库"></a>系统数据库</h2><p>（1）master：SQL SERVER实例的所有<strong>系统级消息</strong>，包括实例范围的元数据（如登录帐号）、端点、链接服务器和系统配置设置。<br>（2）msdb：供SQL SERVER <strong>代理服务</strong>调度报警和作业以及记录操作员的使用，保存关于调度报警、作业、操作员等信息。（备份还原时）<br>（3）model：SQL SERVER 实例上创建的所有<strong>数据库的模板</strong>。<br>（4）tempdb：临时数据库，用于保存临时对象或中间结果集，为数据库的排列等操作提供一个临时工作空间。（每次启动都会重新创建）<br>（5）Resource：一个只读数据库，包含了SQL SERVER 的所有系统对象。（隐藏的数据库）<br>数据库对象的全名应该由<strong>服务器名、数据库名、拥有者名和对象名</strong>这四个部分组成，格式如下：<br>[server].[database].[owner_name].[object_name] </p>
<h2 id="数据库的组成"><a href="#数据库的组成" class="headerlink" title="数据库的组成"></a>数据库的组成</h2><p>（1）主要数据文件：扩展名为 .mdf ，每个数据库有且只能有一个。<br>（2）次要数据文件：扩展名为 .ndf ， 可以没有或有多个。<br>（3）日志文件 扩展名为 .ldf ，用于存放恢复数据库的所有日志信息。</p>
<h2 id="数据的存储分配"><a href="#数据的存储分配" class="headerlink" title="数据的存储分配"></a>数据的存储分配</h2><p>（1）数据的存储分配单位是数据页。一页表是一块8KB的连续磁盘空间。<br>（2）页是存储数据的最小空间分配单位，页的大小决定了数据库表中一行数据的最大大小。</p>
<h1 id="创建数据库和用户"><a href="#创建数据库和用户" class="headerlink" title="创建数据库和用户"></a>创建数据库和用户</h1><p><a href="#jump1">回到目录</a></p>
<p>数据库文件包括：数据文件(mdf)和日志文件(ldf)</p>
<figure class="highlight sql"><figcaption><span>server</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">use master</span><br><span class="line">go</span><br><span class="line"></span><br><span class="line">if <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sysdatabases <span class="keyword">where</span> name<span class="operator">=</span><span class="string">&#x27;sql_wei&#x27;</span>)    <span class="comment">-- 判断数据库是否存在</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">drop</span> database sql_wei</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">create</span> database sql_wei</span><br><span class="line">	<span class="keyword">on</span> <span class="keyword">primary</span>(</span><br><span class="line">	name<span class="operator">=</span><span class="string">&#x27;sql_wei&#x27;</span>,   <span class="comment">-- 文件的逻辑名称</span></span><br><span class="line">	filename<span class="operator">=</span><span class="string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\data\sql_wei.mdf&#x27;</span>, <span class="comment">--文件的路径</span></span><br><span class="line">	size<span class="operator">=</span><span class="number">5</span>mb, <span class="comment">-- 初始化大小，最小3mb</span></span><br><span class="line">	maxsize<span class="operator">=</span><span class="number">100</span>mb, <span class="comment">-- 最大的大小</span></span><br><span class="line">	filegrowth<span class="operator">=</span><span class="number">5</span><span class="operator">%</span>  <span class="comment">-- 自增率</span></span><br><span class="line">	)</span><br><span class="line">	log <span class="keyword">on</span>(</span><br><span class="line">	name<span class="operator">=</span><span class="string">&#x27;sql_wei_log&#x27;</span>,</span><br><span class="line">	filename<span class="operator">=</span><span class="string">&#x27;D:\Program Files\Microsoft SQL Server\MSSQL10_50.MSSQLSERVER\data\sql_wei_log.ldf&#x27;</span>,</span><br><span class="line">	size<span class="operator">=</span><span class="number">5</span>mb,</span><br><span class="line">	maxsize<span class="operator">=</span><span class="number">100</span>mb,</span><br><span class="line">	filegrowth<span class="operator">=</span><span class="number">5</span><span class="operator">%</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">go</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 1.创建登录⽤户(在master库下⾯执⾏)</span></span><br><span class="line">USE master</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> LOGIN readonlylogin <span class="keyword">WITH</span> password<span class="operator">=</span><span class="string">&#x27;abc123...&#x27;</span>;</span><br><span class="line"><span class="comment">-- 2.创建数据库只读⽤户(在某个⽤户数据库下⾯执⾏)</span></span><br><span class="line">USE TestDB</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> readonlyuser <span class="keyword">FROM</span> LOGIN readonlylogin;</span><br><span class="line"><span class="comment">-- 3.将⽤户加⼊数据库角色,例如所有者角色db_owner、只读⾓⾊db_datareader等(在某个⽤户数据库下⾯执⾏)</span></span><br><span class="line">USE TestDB</span><br><span class="line">GO</span><br><span class="line"><span class="keyword">EXEC</span> sp_addrolemember <span class="string">&#x27;db_datareader&#x27;</span>, <span class="string">&#x27;readonlyuser&#x27;</span>;</span><br><span class="line"><span class="comment">--EXEC sp_addrolemember &#x27;db_owner&#x27;, &#x27;readonlyuser&#x27;;----可以将⽤户关联到多个数据库⾓⾊中</span></span><br><span class="line"><span class="comment">--EXEC sp_droprolemember &#x27;db_owner&#x27;, &#x27;readonlyuser&#x27;----从特定的数据⾓⾊中删除⽤户</span></span><br><span class="line"><span class="comment">-- 4.⽤我们刚刚创建的readonlylogin⽤户进⾏登录，登录时要注意将“选项（英⽂是Options）--&gt;连接属性（Connection Properties）--&gt;连接数据库(Connect to database)”改为我们的⽬标数据库例如TestDB下⾯</span></span><br></pre></td></tr></table></figure>

<h1 id="tsql语言相关-区别"><a href="#tsql语言相关-区别" class="headerlink" title="tsql语言相关(区别)"></a>tsql语言相关(区别)</h1><p><a href="#jump1">回到目录</a></p>
<h2 id="分页查询top"><a href="#分页查询top" class="headerlink" title="分页查询top"></a>分页查询top</h2><figure class="highlight sql"><figcaption><span>sever</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- percent将表达式结果转为float(按百分比返回),默认为bigint(行号)</span></span><br><span class="line"><span class="comment">-- with this返回多行相同排名的数据（比如返回两个100分的人）</span></span><br><span class="line"><span class="comment">-- 如果有DISTINCT，则在DISTINCT后面</span></span><br><span class="line"><span class="keyword">select</span> top (expression)  [<span class="keyword">percent</span>]  [<span class="keyword">with</span> this]</span><br><span class="line"><span class="keyword">from</span> table_name</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> column_name; </span><br><span class="line"></span><br><span class="line">top <span class="number">3</span>           top(<span class="number">2.5</span>) <span class="keyword">percent</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 利用子查询、窗口函数实现分页查询</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="operator">*</span>,<span class="built_in">row_number</span>() <span class="keyword">over</span>(<span class="keyword">order</span> <span class="keyword">by</span> 字段) hh) s</span><br><span class="line"><span class="keyword">where</span> s.hh <span class="keyword">between</span> beginindex <span class="keyword">and</span> endindex</span><br><span class="line"><span class="comment">-- 或者利用top</span></span><br><span class="line"><span class="keyword">select</span> top (@条数) <span class="operator">*</span> <span class="keyword">from</span> 表名 <span class="keyword">where</span> id <span class="keyword">not</span> <span class="keyword">in</span> (selecct top (@页数<span class="number">-1</span>)<span class="operator">*</span>@条数) id <span class="keyword">from</span> 表名)</span><br></pre></td></tr></table></figure>
<h2 id="向自增列identity插入数据"><a href="#向自增列identity插入数据" class="headerlink" title="向自增列identity插入数据"></a>向自增列identity插入数据</h2><p>MySQL一张表只能有一个自增列。auto_increment<br>插入数据必须<strong>使用null</strong>来表示插入的是自增列。<br>SQL Server插入数据可以且必须<strong>无视该列</strong>。</p>
<h2 id="交并差"><a href="#交并差" class="headerlink" title="交并差"></a>交并差</h2><p>mysql中只有union并集<br>sqlserver中有交intersect、并union、差except</p>
<h2 id="DDL、DML、DQL"><a href="#DDL、DML、DQL" class="headerlink" title="DDL、DML、DQL"></a>DDL、DML、DQL</h2><table>
<thead>
<tr>
<th>功能</th>
<th align="left">sql server</th>
<th>mysql(*表示同左)</th>
</tr>
</thead>
<tbody><tr>
<td>查看表结构</td>
<td align="left"><strong>exec</strong> sp_help 表名;</td>
<td>desc 表名;</td>
</tr>
<tr>
<td>修改表名</td>
<td align="left"><strong>exec</strong> sp_rename 旧表名,新表名;<br />exec sp_rename ‘表.旧列’,’新列’,’column’;</td>
<td>alter table 旧表名 rename 新表名;<br />alter table 表 <strong>change</strong> 列</td>
</tr>
<tr>
<td>删除表</td>
<td align="left">if <strong>object_id</strong>(‘表名’) <strong>is</strong> <strong>not</strong> <strong>null</strong> <strong>drop</strong> table 表名;</td>
<td><strong>drop</strong> table if <strong>exists</strong> 表名;</td>
</tr>
<tr>
<td>复制表(mysql复制表结构不会复制自增属性)</td>
<td align="left"><strong>select</strong> * <strong>into</strong> 表1 <strong>from</strong> 表2; （复制数据和结构） <br><strong>select</strong> * <strong>into</strong> 表1 <strong>from</strong> 表2 <strong>where</strong> 1&#x3D;0;   （复制结构）</td>
<td><strong>create table</strong> 表1 <strong>as</strong> <strong>select</strong> <strong>from</strong> 表2;（复制数据和结构）<br><strong>create</strong> <strong>table</strong> 表1 <strong>like</strong> 表2;（复制结构）</td>
</tr>
<tr>
<td>修改列(在属性<strong>添加非空</strong>约束)</td>
<td align="left">alter table 表 <strong>alter column</strong> 列 新属性[not null];</td>
<td>alter table 表 <strong>modify</strong> 列 类型 [not null];<br>alter table 表 <strong>change</strong> 旧列 新列 新类型</td>
</tr>
<tr>
<td>添加列&#x2F;删除列</td>
<td align="left">alter table 表 <strong>add</strong> 列  属性;<br>alter table 表 <strong>drop</strong> 列</td>
<td>*</td>
</tr>
<tr>
<td>添加约束(<strong>注意外键默认非空</strong>）</td>
<td align="left">alter table 表 <strong>add constraint</strong> 约束名 <strong>primary key|unique|check (列名)</strong>;<br><strong>foreign key</strong> (列) <strong>references</strong> 主表(列);<br><strong>default</strong> ‘值’ <strong>for</strong> 列</td>
<td>主键、唯一、外键约束同左(<strong>不写约束名</strong>);<br>非空和默认用修改列属性方法modify</td>
</tr>
<tr>
<td>删除约束</td>
<td align="left">alter table 表 <strong>drop constraint</strong> 约束名</td>
<td>*</td>
</tr>
<tr>
<td></td>
<td align="left"></td>
<td></td>
</tr>
<tr>
<td>连接查询</td>
<td align="left">全连接full join</td>
<td>无</td>
</tr>
</tbody></table>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><p><a href="#jump1">回到目录</a></p>
<h2 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h2><p>bit:bit数据类型代表0,1或NULL,就是表示true,false.占用1byte.<br>int:以4个字节来存储正负数.可存储范围为:-2^31至2^31-1.<br>smallint:以2个字节来存储正负数.存储范围为:-2^15至2^15-1<br>tinyint: 是最小的整数类型,仅用1字节,范围:0至此2^8-1</p>
<h2 id="精确数值"><a href="#精确数值" class="headerlink" title="精确数值"></a>精确数值</h2><p>numeric:表示的数字可以达到38位,存储数据时所用的字节数目会随着使用权用位数的多少变化.<br>decimal:和numeric差不多  </p>
<h2 id="浮点数"><a href="#浮点数" class="headerlink" title="浮点数"></a>浮点数</h2><p>float:用8个字节来存储数据.最多可为53位.范围为:-1.79E+308至1.79E+308.<br>real:位数为24,用4个字节,数字范围:-3.04E+38至3.04E+38</p>
<h2 id="日期时间"><a href="#日期时间" class="headerlink" title="日期时间"></a>日期时间</h2><p>datatime:表示时间范围可以表示从1753&#x2F;1&#x2F;1至9999&#x2F;12&#x2F;31,时间可以表示到3.33&#x2F;1000秒.使用8个字节.<br>smalldatetime:表示时间范围可以表示从1900&#x2F;1&#x2F;1至2079&#x2F;12&#x2F;31.使用4个字节.</p>
<h2 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h2><p>char:长度是设定的,最短为1字节,最长为8000个字节.不足的长度会用空白补上.<br>varchar:长度也是设定的,最短为1字节,最长为8000个字节,尾部的空白会去掉.<br>text:长宽也是设定的,最长可以存放2G的数据.</p>
<h2 id="Unincode字符串"><a href="#Unincode字符串" class="headerlink" title="Unincode字符串"></a>Unincode字符串</h2><p>nchar:长度是设定的,最短为1字节,最长为4000个字节.不足的长度会用空白补上.储存一个字符需要2个字节.<br>nvarchar:长度是设定的,最短为1字节,最长为4000个字节.尾部的空白会去掉.储存一个字符需要2个字节.<br>ntext:长度是设定的,最短为1字节,最长为2G.尾部的空白会去掉,储存一个字符需要2个字节.</p>
<h2 id="货币数据"><a href="#货币数据" class="headerlink" title="货币数据"></a>货币数据</h2><p>money:记录金额范围为:-92233720368577.5808至92233720368577.5807.需要8 个字节.<br>smallmoney:记录金额范围为:-214748.3648至214748.36487.需要4个字节.</p>
<h2 id="标记"><a href="#标记" class="headerlink" title="标记"></a>标记</h2><p>timestamp:该数据类型在每一个表中是唯一的!当表中的一个记录更改时,该记录的timestamp字段会自动更新.<br>uniqueidentifier:用于识别数据库里面许多个表的唯一一个记录.</p>
<h2 id="二进制码字符串"><a href="#二进制码字符串" class="headerlink" title="二进制码字符串"></a>二进制码字符串</h2><p>binary:固定长度的二进制码字符串字段,最短为1,最长为8000.</p>
<p>image:为可变长度的二进制码字符串,最长2G.</p>
<p>varbinary:与binary差异为数据尾部是00时,varbinary会将其去掉</p>
<h1 id="运算符计算区别"><a href="#运算符计算区别" class="headerlink" title="运算符计算区别"></a>运算符计算区别</h1><p><a href="#jump1">回到目录</a></p>
<p>()&gt;算数&gt;比较&gt;逻辑&gt;拼接&gt;赋值<br>not&gt;and&gt;or</p>
<table>
<thead>
<tr>
<th>计算类型</th>
<th>sql server(向数值长度看齐)</th>
<th>mysql(随意,都能成功)</th>
<th>oracle(同mysql)</th>
</tr>
</thead>
<tbody><tr>
<td>整型&#x2F;整型</td>
<td>1&#x2F;2&#x3D;0</td>
<td>1&#x2F;2&#x3D;0.5</td>
<td>1&#x2F;2&#x3D;0.5</td>
</tr>
<tr>
<td>整型+整形字符串</td>
<td>1+’1’&#x3D;2</td>
<td>*</td>
<td>*</td>
</tr>
<tr>
<td>整形长度&lt;字符</td>
<td>1+’1.1’   报错</td>
<td>*</td>
<td>*</td>
</tr>
<tr>
<td>整型长度&gt;字符长度</td>
<td>1.0+’1’&#x3D;2.0</td>
<td>*</td>
<td>*</td>
</tr>
<tr>
<td></td>
<td></td>
<td>1+’1a’&#x3D;2<br>1+’a1’&#x3D;1</td>
<td>报错</td>
</tr>
</tbody></table>
<p>向上取整ceiling()           向下取整floor()</p>
<p>Oracle不能将字符和数字相加,</p>
<h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h1><p><a href="#jump1">回到目录</a></p>
<p><a target="_blank" rel="noopener" href="https://learn.microsoft.com/zh-cn/sql/t-sql/functions/functions?view=sql-server-2016">sql server2016官方教程</a></p>
<h2 id="时间函数"><a href="#时间函数" class="headerlink" title="时间函数"></a>时间函数</h2><table>
<thead>
<tr>
<th>带世纪位</th>
<th>格式</th>
<th>符号</th>
</tr>
</thead>
<tbody><tr>
<td>111</td>
<td>yyyy&#x2F;mm&#x2F;dd*</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>103</td>
<td>dd&#x2F;mm&#x2F;yyyy</td>
<td>&#x2F;</td>
</tr>
<tr>
<td>102</td>
<td>yyyy.mm.dd*</td>
<td>.</td>
</tr>
<tr>
<td>104</td>
<td>dd.mm.yyyy</td>
<td>.</td>
</tr>
<tr>
<td>23</td>
<td>yyyy-mm-dd*</td>
<td>-</td>
</tr>
<tr>
<td>105</td>
<td>dd-mm-yyyy</td>
<td>-</td>
</tr>
<tr>
<td>112</td>
<td>yyyymmdd</td>
<td></td>
</tr>
<tr>
<td>20、120</td>
<td>yyyy-mm-dd hh:mi:ss24 小时制）*</td>
<td>-</td>
</tr>
<tr>
<td>108</td>
<td>hh:mi:ss</td>
<td>:</td>
</tr>
<tr>
<td>114</td>
<td>hh:mi:ss:mmm（24 小时制）</td>
<td>:</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>日期参数</th>
<th>缩写</th>
<th>中文</th>
</tr>
</thead>
<tbody><tr>
<td>year</td>
<td>yy</td>
<td>年</td>
</tr>
<tr>
<td>quarter</td>
<td>qq</td>
<td>季度</td>
</tr>
<tr>
<td>month</td>
<td>mm</td>
<td>月</td>
</tr>
<tr>
<td>day</td>
<td>dd</td>
<td>日</td>
</tr>
<tr>
<td>week</td>
<td>ww</td>
<td>周</td>
</tr>
<tr>
<td>hour</td>
<td>hh</td>
<td>时</td>
</tr>
<tr>
<td>mintue</td>
<td>mi*</td>
<td>分</td>
</tr>
<tr>
<td>secend</td>
<td>ss</td>
<td>秒</td>
</tr>
<tr>
<td>dayofyear</td>
<td>dy</td>
<td>一年中的第几天</td>
</tr>
<tr>
<td>weekday</td>
<td>dw</td>
<td>星期几</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>功能</th>
<th>语法</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>获取当前时间(到秒)</td>
<td>getdate()</td>
<td></td>
</tr>
<tr>
<td>增加时间</td>
<td>dateadd(yy, 1, ‘2024.1.2’)</td>
<td>加1年</td>
</tr>
<tr>
<td>计算时间差</td>
<td>datediff(dd,’2024.1.2’,’2027.3.4’)</td>
<td>算中间有多少天</td>
</tr>
<tr>
<td>取时间字段(datename返回字符串)</td>
<td>datepart(yy,’2024.1.2’)</td>
<td>返回2024(数值)</td>
</tr>
<tr>
<td>判断是否是日期(可以用来判断闰年)返回1,0</td>
<td>isdate(‘2024.2.29’)</td>
<td>如果1则闰年</td>
</tr>
</tbody></table>
<h2 id="排序函数"><a href="#排序函数" class="headerlink" title="排序函数"></a>排序函数</h2><table>
<thead>
<tr>
<th>语法</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>rank()</td>
<td>跳跃1224</td>
</tr>
<tr>
<td>dense_rank()</td>
<td>不跳跃1223</td>
</tr>
<tr>
<td>row_number()</td>
<td>行1234…</td>
</tr>
<tr>
<td>ntile(n)</td>
<td>分成n组，第一组内的排名全1，第二组内的排名全2….</td>
</tr>
</tbody></table>
<h2 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h2><table>
<thead>
<tr>
<th>功能</th>
<th>语法</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>ascii码和char之间转换</td>
<td>ascii()和char()</td>
<td>A-65<br />a-97<br />1-49</td>
</tr>
<tr>
<td>字符串搜索</td>
<td>patindex(‘%ab%’,’accabc’)<br>patindex(‘%[^ 0-9A-Za-z]%’,’ass!a’)<br />patindex(‘%’ + @a + ‘%’,’SadDAS’)</td>
<td>返回结果4<br />查找不是数字大小写字母的第一个位置，返回结果为4<br>使用变量</td>
</tr>
<tr>
<td>连接</td>
<td>concat(‘1’,’a’,null,’b’)</td>
<td>1ab</td>
</tr>
<tr>
<td>自定义字符串格式</td>
<td>format(123456,’##-##&#x2F;##)</td>
<td>12-34&#x2F;56</td>
</tr>
<tr>
<td>取左边字符</td>
<td>left(‘abc’,2)</td>
<td>b</td>
</tr>
<tr>
<td>返回字符数<br />返回字节数</td>
<td>len(12)<br />datalength(1)</td>
<td>2<br />4</td>
</tr>
<tr>
<td>大小写互换</td>
<td>lower()&#x2F;upper()</td>
<td></td>
</tr>
<tr>
<td>去左右空格</td>
<td>ltrim()&#x2F;rtrim()</td>
<td></td>
</tr>
<tr>
<td>替换字符串(可以用来求空格数)</td>
<td>replace(‘asdad’,’sd’,’bb’)<br />replace(‘asd ag’,’ ‘,’’)</td>
<td>abbad<br />用替换前的len-替换后的len</td>
</tr>
<tr>
<td>插入&#x2F;替换功能</td>
<td>stuff(‘abcdef’, 2, 2, ‘ijk’)</td>
<td>从第2个开始删除2个字符并插入后面的字符，结果为aijkdef</td>
</tr>
<tr>
<td>选择字符段</td>
<td>substring(‘abcd’,2,3)</td>
<td>选择从第2个字符开始的3个字符，结果为bcd</td>
</tr>
<tr>
<td>转置字符串顺序</td>
<td>reverse(‘abc’)</td>
<td>cba</td>
</tr>
</tbody></table>
<h2 id="转换函数"><a href="#转换函数" class="headerlink" title="转换函数"></a>转换函数</h2><table>
<thead>
<tr>
<th>函数</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>cast(‘123’ as int)<br />convert(int,’123’)</td>
<td>将字符型123转换成int型123</td>
</tr>
<tr>
<td>try_cast()<br />try_convert()</td>
<td>尝试转换，失败返回null成功和上面一样</td>
</tr>
</tbody></table>
<h2 id="分析函数-和over配合"><a href="#分析函数-和over配合" class="headerlink" title="分析函数(和over配合)"></a>分析函数(和over配合)</h2><table>
<thead>
<tr>
<th>函数</th>
<th>效果</th>
</tr>
</thead>
<tbody><tr>
<td>LAG(列名,1,0) [ignore nulls  | respect nulls]</td>
<td>返回该列上面1行的值，如果是第1行默认为0<br>作用：对于行之间的比较可以不用自连接<br>忽略空,取上面第一个不为空的值;不忽略则取null</td>
</tr>
<tr>
<td>LEAD(列名,1,0) [ignore nulls|respect nulls]</td>
<td>同上,只不过返回下1行的值</td>
</tr>
<tr>
<td>percent_rank()</td>
<td>返回百分比</td>
</tr>
<tr>
<td>rank()&#x2F;dense_rank()&#x2F;row_number()</td>
<td>跳跃，不跳，行</td>
</tr>
</tbody></table>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p><a href="#jump1">回到目录</a></p>
<p>默认为自动提交和显示模式<br>开启隐式事务：set implicit_transactions on</p>
<table>
<thead>
<tr>
<th>事务模式</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>自动提交事务</td>
<td>每条语句都是单独一个事务</td>
</tr>
<tr>
<td>显式事务</td>
<td>每个事务以 BEGIN TRANSACTION 开始，以 COMMIT 或 ROLLBACK 结束。</td>
</tr>
<tr>
<td>隐式事务</td>
<td>前一个事务完成时，新事务隐式启动，但每个事务仍以 COMMIT 或 ROLLBACK 结束。</td>
</tr>
<tr>
<td>批处理事务</td>
<td>应用于多个活动结果集 (MARS)，在 MARS 会话中启动显式或隐式事务变为批处理级事务。 当批处理完成时没有提交或回滚的批处理级事务自动由 SQL Server 进行回滚。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>基本语法</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>begin tran [名称|@名称]</td>
<td>开启事务</td>
</tr>
<tr>
<td>commit tran</td>
<td>提交(提交最近的一条事务)</td>
</tr>
<tr>
<td>rollback tran</td>
<td>回滚(回滚全部事务)</td>
</tr>
<tr>
<td>save tran 名称</td>
<td>在事务内设置保存点</td>
</tr>
</tbody></table>
<h2 id="报错的处理"><a href="#报错的处理" class="headerlink" title="报错的处理"></a>报错的处理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">-- 1、使用try...catch</span><br><span class="line">BEGIN TRY</span><br><span class="line">    BEGIN TRANSACTION</span><br><span class="line">    -- 执行一系列操作</span><br><span class="line">    COMMIT TRANSACTION</span><br><span class="line">END TRY</span><br><span class="line">BEGIN CATCH</span><br><span class="line">    ROLLBACK TRANSACTION</span><br><span class="line">    -- 处理错误的逻辑</span><br><span class="line">END CATCH</span><br><span class="line"></span><br><span class="line">-- 2、使用SET XACT_ABORT语句来自动回滚事务</span><br><span class="line">-- 开启后，事务内报错将会回滚全部操作(默认off，推荐开启)</span><br><span class="line">SET XACT_ABORT ON</span><br><span class="line"></span><br><span class="line">BEGIN TRANSACTION</span><br><span class="line">-- 执行一系列操作</span><br><span class="line">IF @@ERROR &lt;&gt; 0</span><br><span class="line">	BEGIN</span><br><span class="line">    	ROLLBACK TRANSACTION</span><br><span class="line">   	 -- 处理错误的逻辑</span><br><span class="line">	END</span><br><span class="line">ELSE</span><br><span class="line">	BEGIN</span><br><span class="line">    	COMMIT TRANSACTION</span><br><span class="line">	END</span><br><span class="line"></span><br><span class="line">-- 3.通过raiseerror来抛出错误</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h1><p><a href="#jump1">回到目录</a></p>
<p>一组经过预先编译的sql，来完成特定的事情。当存储过程执行一次后，可以将语句<strong>缓存在内存</strong>中，这样下次执行的时候直接使用缓存中的语句。这样就可以提高存储过程的性能。with recompile取消缓存</p>
<p>优点：</p>
<ul>
<li>减少sql重用率</li>
<li>减少网络传输量(在开发架构中只需要向sql发送存储过程即可获取持久化数据)</li>
<li>提高安全性(不会暴露sql)</li>
</ul>
<h2 id="常见存储过程"><a href="#常见存储过程" class="headerlink" title="常见存储过程"></a>常见存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exec</span> sp_databases; <span class="comment">-- 查看数据库</span></span><br><span class="line"><span class="keyword">exec</span> sp_tables; <span class="comment">-- 查看表 </span></span><br><span class="line"><span class="keyword">exec</span> sp_columns student;<span class="comment">-- 查看列 </span></span><br><span class="line"><span class="keyword">exec</span> sp_helpIndex student;<span class="comment">-- 查看索引 </span></span><br><span class="line"><span class="keyword">exec</span> sp_helpConstraint student;<span class="comment">-- 约束 </span></span><br><span class="line"><span class="keyword">exec</span> sp_stored_procedures; </span><br><span class="line"><span class="comment">-- 查看存储过程的sql语句内容</span></span><br><span class="line"><span class="keyword">exec</span> sp_helptext <span class="string">&#x27;sp_stored_procedures&#x27;</span>;</span><br><span class="line"><span class="comment">-- 重命名表，列，库</span></span><br><span class="line"><span class="keyword">exec</span> sp_rename studentinfo,student</span><br><span class="line"><span class="keyword">exec</span> sp_rename <span class="string">&#x27;student.列&#x27;</span>,<span class="string">&#x27;新列名&#x27;</span>,<span class="string">&#x27;column&#x27;</span></span><br><span class="line"><span class="keyword">exec</span> sp_renamedb myTempDB, myDB;<span class="comment">-- 更改数据库名称 </span></span><br><span class="line"><span class="keyword">exec</span> sp_defaultdb <span class="string">&#x27;master&#x27;</span>, <span class="string">&#x27;myDB&#x27;</span>;<span class="comment">-- 更改登录名的默认数据库 </span></span><br><span class="line"><span class="keyword">exec</span> sp_helpdb;<span class="comment">-- 数据库帮助，查询数据库信息 </span></span><br><span class="line"><span class="keyword">exec</span> sp_helpdb master;</span><br></pre></td></tr></table></figure>

<p><strong>判断存储过程是否存在的两种方式：</strong></p>
<p>if exists(select * from sys.objects where name&#x3D;’存储过程名’ )</p>
<p>if (object_id(‘存储过程名’, ‘P’) is not null)   –P是指定存储过程类型<br>object_id(‘对象名’,’类型’)</p>
<p>常用对象类型：<br><code>C</code> &#x3D; 检查约束<br><code>D</code> &#x3D; 默认值（约束或独立）<br><code>F</code> &#x3D; 外键约束<br><code>P</code> &#x3D; SQL 存储过程<br><code>PK</code> &#x3D; 主键约束<br><code>U</code> &#x3D; 表（用户定义的）<br><code>V</code> &#x3D; 视图</p>
<h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建         输入参数为默认，out是输出参数，output会返回给调用方</span></span><br><span class="line">if (object_id(<span class="string">&#x27;存储过程名&#x27;</span>, <span class="string">&#x27;P&#x27;</span>) <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>)</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> <span class="string">&#x27;存储过程名&#x27;</span></span><br><span class="line">go</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> 存储过程名称(@参数 参数数据类型 <span class="keyword">out</span><span class="operator">|</span>output) </span><br><span class="line">[<span class="keyword">with</span> 存储过程选项]</span><br><span class="line">[<span class="keyword">for</span> replication]    <span class="comment">-- 该存储过程仅用来复制，不能带参数</span></span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">.....</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">go    <span class="comment">-- 一定要加go</span></span><br><span class="line"></span><br><span class="line">存储过程选项：encryption(加密，无法在视图中查看)、recompile(执行后不再缓存)、<span class="keyword">execute</span> <span class="keyword">as</span> clause</span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">declare</span></span><br><span class="line"><span class="variable">@id</span> <span class="type">int</span><span class="operator">=</span><span class="number">2</span>,</span><br><span class="line"><span class="variable">@name</span> <span class="type">varchar</span>(<span class="number">20</span>)</span><br><span class="line"><span class="keyword">exec</span> proc_find_stu1 <span class="variable">@id</span> ,<span class="variable">@name</span> <span class="keyword">out</span> </span><br><span class="line"><span class="keyword">exec</span> 存储过程名 @变量 [参数类型]</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">procedure</span> [if <span class="keyword">exists</span>] 名称</span><br></pre></td></tr></table></figure>

<h2 id="常用关键词"><a href="#常用关键词" class="headerlink" title="常用关键词"></a>常用关键词</h2><table>
<thead>
<tr>
<th>常用语法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>赋值</td>
<td>set 只能给一个变量赋值<br>select 可以给多个变量赋值</td>
</tr>
<tr>
<td>raiserror(‘分数传入错误’，错误级别，消息状态)</td>
<td>消息号默认50000，可自定义消息好<br>错误级别0-10，不会跳到catch<br>11-19，跳到catch<br>20+，sysadmin角色成员用with log指定<br>消息状态1-127，默认1</td>
</tr>
<tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- if</span></span><br><span class="line">if(条件)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"> ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line"> ...</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- while</span></span><br><span class="line">while(条件)</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	...</span><br><span class="line">	break</span><br><span class="line">	continue</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- case</span></span><br><span class="line"><span class="keyword">case</span> <span class="keyword">when</span> ... <span class="keyword">then</span> ...</span><br><span class="line">     <span class="keyword">when</span> ... <span class="keyword">then</span> ...</span><br><span class="line">     <span class="keyword">else</span> ...</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<h2 id="动态执行-高度自定义-存储过程sql"><a href="#动态执行-高度自定义-存储过程sql" class="headerlink" title="动态执行(高度自定义)存储过程sql"></a>动态执行(高度自定义)存储过程sql</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- exec sp_executesql @变量,参数设置,实际参数</span></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@sqlName</span><span class="operator">=</span><span class="string">&#x27;select @i = COUNT(0) from students&#x27;</span>;</span><br><span class="line"><span class="keyword">exec</span> sp_executesql <span class="variable">@sqlName</span>,N<span class="string">&#x27;@i int output&#x27;</span>,<span class="variable">@i</span> output</span><br><span class="line"></span><br><span class="line"><span class="variable">@sqlName</span>：需要执行的<span class="keyword">sql</span></span><br><span class="line"></span><br><span class="line">N<span class="string">&#x27;@i int output&#x27;</span>：参数，相当于定义时候的参数 N开头意思为后⾯的数据类型为<span class="type">NChar</span>或者NVarchar 使⽤N前缀 </span><br><span class="line"></span><br><span class="line"><span class="variable">@i</span> output：相当于调用，调用之后就能获取到数据</span><br></pre></td></tr></table></figure>

<p>一般表名和列名不会作为动态sql的参数传入，使用<code>QUOTENAME</code>函数来设置sql语句中的表名和列名，用于确保表名是安全的，防止SQL注入。<br>例如：’select * from ‘ + quotename(@tablename)</p>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p><a href="#jump1">回到目录</a></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看表中索引</span></span><br><span class="line"><span class="keyword">exec</span> sp_helpindex 表名</span><br><span class="line"><span class="comment">-- 创建</span></span><br><span class="line"><span class="keyword">create</span> [<span class="keyword">unique</span><span class="operator">|</span>clustered<span class="operator">|</span>noclustered] index 索引名</span><br><span class="line"><span class="keyword">on</span> 表名(列名 [<span class="keyword">desc</span><span class="operator">|</span><span class="keyword">asc</span>])</span><br><span class="line"><span class="comment">-- 添加</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">add</span> index(字段)</span><br><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="keyword">drop</span> index 索引名 <span class="keyword">on</span> 表名</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> index 索引名</span><br></pre></td></tr></table></figure>

<ol>
<li>为经常用于查询条件的列创建索引。</li>
<li>对于频繁需要排序的列，可以创建索引以加速排序操作。</li>
<li>为经常需要更新的表创建索引时，考虑索引维护的代价。</li>
<li>对于有大量数据更新的表，避免在频繁更新的列上创建索引。</li>
<li>对于包含多个列的查询条件，创建复合索引，确保索引的列顺序与查询条件匹配。</li>
<li>使用特定的索引类型，如全文索引，适用于文本搜索。</li>
</ol>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>分离，备份，恢复<br>1.右键数据库名-&gt;’属性‘-&gt;选项-&gt;状态-&gt;设置单用户single-user<br>2.右键数据库名-&gt;’任务’-&gt;’分离’<br>然后将mdf和ldf文件移到别的地方<br>3.右键数据库选‘附加’<br>4.将之前分离的数据库文件路径附加到新数据库引擎</p>
<p>第一范式（1NF): 确保每列的原子性(强调的是列的原子性，即列不能够再分成其他几列)。实际上，第一范式是所有关系型数据库的最基本要求。</p>
<p>第二范式（2NF): 是在第一范式（1NF）的基础上建立起来的，即满足第二范式（2NF）必须先满足第一范式（1NF）<br>第二范式要求确保表中每列与主键相关，而不能只与主键的某部分相关（主要针对联合主键），主键列与非主键列遵循完全函数依赖关系，也就是完全依赖</p>
<p>第三范式（3NF): 是在第二范式的基础上建立起来的。第三范式指：属性不依赖于其他非主属性<br>第三范式确保主键列之间没有传递函数依赖关系，也就是消除传递依赖</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/sql-server/" rel="tag"># sql server</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/05/10/sql/MYSQL/" rel="prev" title="mysql基础篇+进阶篇+运维篇">
      <i class="fa fa-chevron-left"></i> mysql基础篇+进阶篇+运维篇
    </a></div>
      <div class="post-nav-item">
    <a href="/2024/06/06/docker/docker/" rel="next" title="docker使用操作">
      docker使用操作 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="nav-number">1.1.</span> <span class="nav-text">系统数据库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E7%BB%84%E6%88%90"><span class="nav-number">1.2.</span> <span class="nav-text">数据库的组成</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%9A%84%E5%AD%98%E5%82%A8%E5%88%86%E9%85%8D"><span class="nav-number">1.3.</span> <span class="nav-text">数据的存储分配</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E7%94%A8%E6%88%B7"><span class="nav-number">2.</span> <span class="nav-text">创建数据库和用户</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#tsql%E8%AF%AD%E8%A8%80%E7%9B%B8%E5%85%B3-%E5%8C%BA%E5%88%AB"><span class="nav-number">3.</span> <span class="nav-text">tsql语言相关(区别)</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2top"><span class="nav-number">3.1.</span> <span class="nav-text">分页查询top</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%91%E8%87%AA%E5%A2%9E%E5%88%97identity%E6%8F%92%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="nav-number">3.2.</span> <span class="nav-text">向自增列identity插入数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%A4%E5%B9%B6%E5%B7%AE"><span class="nav-number">3.3.</span> <span class="nav-text">交并差</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DDL%E3%80%81DML%E3%80%81DQL"><span class="nav-number">3.4.</span> <span class="nav-text">DDL、DML、DQL</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="nav-number">4.</span> <span class="nav-text">数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%95%B4%E6%95%B0"><span class="nav-number">4.1.</span> <span class="nav-text">整数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B2%BE%E7%A1%AE%E6%95%B0%E5%80%BC"><span class="nav-number">4.2.</span> <span class="nav-text">精确数值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%AE%E7%82%B9%E6%95%B0"><span class="nav-number">4.3.</span> <span class="nav-text">浮点数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E6%97%B6%E9%97%B4"><span class="nav-number">4.4.</span> <span class="nav-text">日期时间</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">4.5.</span> <span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unincode%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">4.6.</span> <span class="nav-text">Unincode字符串</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B4%A7%E5%B8%81%E6%95%B0%E6%8D%AE"><span class="nav-number">4.7.</span> <span class="nav-text">货币数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%87%E8%AE%B0"><span class="nav-number">4.8.</span> <span class="nav-text">标记</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E8%BF%9B%E5%88%B6%E7%A0%81%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-number">4.9.</span> <span class="nav-text">二进制码字符串</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6%E8%AE%A1%E7%AE%97%E5%8C%BA%E5%88%AB"><span class="nav-number">5.</span> <span class="nav-text">运算符计算区别</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0"><span class="nav-number">6.</span> <span class="nav-text">常用函数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%97%B6%E9%97%B4%E5%87%BD%E6%95%B0"><span class="nav-number">6.1.</span> <span class="nav-text">时间函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8E%92%E5%BA%8F%E5%87%BD%E6%95%B0"><span class="nav-number">6.2.</span> <span class="nav-text">排序函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-number">6.3.</span> <span class="nav-text">字符串函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0"><span class="nav-number">6.4.</span> <span class="nav-text">转换函数</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E5%87%BD%E6%95%B0-%E5%92%8Cover%E9%85%8D%E5%90%88"><span class="nav-number">6.5.</span> <span class="nav-text">分析函数(和over配合)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BA%8B%E5%8A%A1"><span class="nav-number">7.</span> <span class="nav-text">事务</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8A%A5%E9%94%99%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">7.1.</span> <span class="nav-text">报错的处理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">8.</span> <span class="nav-text">存储过程</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="nav-number">8.1.</span> <span class="nav-text">常见存储过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95"><span class="nav-number">8.2.</span> <span class="nav-text">语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8%E5%85%B3%E9%94%AE%E8%AF%8D"><span class="nav-number">8.3.</span> <span class="nav-text">常用关键词</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E6%89%A7%E8%A1%8C-%E9%AB%98%E5%BA%A6%E8%87%AA%E5%AE%9A%E4%B9%89-%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8Bsql"><span class="nav-number">8.4.</span> <span class="nav-text">动态执行(高度自定义)存储过程sql</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B4%A2%E5%BC%95"><span class="nav-number">9.</span> <span class="nav-text">索引</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">10.</span> <span class="nav-text">其他</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="我真不是雪上加霜"
      src="/images/%E5%85%AD%E8%8A%B1.gif">
  <p class="site-author-name" itemprop="name">我真不是雪上加霜</p>
  <div class="site-description" itemprop="description">失败总是贯穿人生始终</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">我真不是雪上加霜</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">197k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">2:59</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
